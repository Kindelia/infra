http:
  routers:
    to-old-kindelia-org:
      rule: "Host(`old.kindelia.org`)"
      service: old-kindelia-org
      entryPoints:
        - web
    to-old-kindelia-org-secure:
      rule: "Host(`old.kindelia.org`)"
      service: old-kindelia-org
      entryPoints:
        - web-secure
      tls:
        certResolver: lets-encrypt
        domains:
          - main: "old.kindelia.org"
    to-kindelia-org:
      service: kindelia-org
      # rule: "Host(`kindelia.org`, `kindelia.io`)"
      rule: "PathPrefix(`/`)"
      entryPoints:
        - web
      middlewares:
        - alts-redirect
    to-kindelia-org-secure:
      service: kindelia-org
      rule: "Host(`kindelia.org`, `kindelia.io`, `kdl.li`)"
      # rule: "Host(`*`)"
      entryPoints:
        - web-secure
      middlewares:
        - alts-redirect
      tls:
        certResolver: lets-encrypt
        domains:
          - main: kindelia.org
            sans:
              - "kindelia.io"
              - "kdl.li"
  middlewares:
    # https-redirect:
    #   redirectScheme:
    #     scheme: https
    #     permanent: true
    alts-redirect:
      redirectRegex:
        regex: "^https?://(.+?)/(.*)"
        replacement: "https://kindelia.org/${2}"
  services:
    old-kindelia-org:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:7170"
    kindelia-org:
      loadBalancer:
        servers:
          - url: "http://host.docker.internal:8000"
